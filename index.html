
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工具</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- jsPDF CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- pdf-lib CDN for PDF manipulation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <style>
        .drop-zone {
            border: 2px dashed #cbd5e0;
            transition: all 0.3s ease;
        }
        .drop-zone.drag-over {
            border-color: #3b82f6;
            background-color: #eff6ff;
        }
        .preview-container {
            transition: transform 0.2s ease;
        }
        .preview-container:hover {
            transform: scale(1.02);
        }
        .stamp-preview {
            mix-blend-mode: multiply;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .success-pulse {
            animation: successPulse 1s ease-in-out;
        }
        @keyframes successPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        textarea {
            width: 100%;
            height: 400px;
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 4px;
            resize: vertical;
        }
        button {
            padding: 12px 24px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .tips {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">
    <!-- 导航栏 -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <i class="fas fa-stamp text-blue-600 text-2xl mr-3"></i>
                    <h1 class="text-xl font-bold text-gray-800">PDF盖章工具</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="settingsBtn" class="text-gray-600 hover:text-blue-600 transition-colors">
                        <i class="fas fa-cog text-lg"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主内容区域 -->
    <main class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- 功能说明 -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-gray-800 mb-4">PDF文档盖章工具</h2>
            <p class="text-gray-600 mb-4">上传PDF文档和透明PNG图片，将图片作为印章添加到PDF文档上方，支持透明效果不遮挡文字。</p>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-500">
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                <span>支持透明PNG图片</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                    <span>无遮挡文字效果</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                    <span>实时预览功能</span>
                </div>
                <div class="flex items-center">
                    <i class="fas fa-check-circle text-green-500 mr-2"></i>
                    <span>多位置盖章支持</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- 左侧：文件上传区域 -->
            <div class="space-y-6">
                <!-- PDF上传区域 -->
                <div class="bg-white rounded-lg shadow-md p-6 fade-in">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-file-pdf text-red-500 mr-2"></i>
                        选择PDF文档
                    </h3>
                    <div id="pdfDropZone" class="drop-zone rounded-lg p-8 text-center cursor-pointer">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 mb-2">点击或拖拽PDF文件到这里</p>
                        <p class="text-sm text-gray-400">支持所有标准PDF文档</p>
                        <input type="file" id="pdfInput" accept=".pdf" class="hidden">
                    </div>
                    <div id="pdfPreview" class="mt-4 hidden">
                        <h4 class="text-md font-medium text-gray-700 mb-2">PDF预览</h4>
                        <div class="border rounded-lg p-4 bg-gray-50">
                            <p id="pdfFileName" class="text-blue-600 font-medium"></p>
                        </div>
                    </div>
                </div>

                <!-- 图片上传区域 -->
                <div class="bg-white rounded-lg shadow-md p-6 fade-in">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-image text-green-500 mr-2"></i>
                        选择印章图片
                    </h3>
                    <div id="imageDropZone" class="drop-zone rounded-lg p-8 text-center cursor-pointer">
                        <i class="fas fa-stamp text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 mb-2">点击或拖拽PNG图片到这里</p>
                        <p class="text-sm text-gray-400">推荐使用透明背景PNG格式</p>
                        <input type="file" id="imageInput" accept=".png,.jpg,.jpeg" class="hidden">
                    </div>
                    <div id="imagePreview" class="mt-4 hidden">
                        <h4 class="text-md font-medium text-gray-700 mb-2">印章预览</h4>
                        <div class="flex justify-center">
                            <img id="stampPreview" class="max-w-xs max-h-32 object-contain border rounded stamp-preview">
                        </div>
                    </div>
                </div>
            </div>

            <!-- 右侧：控制面板和预览区域 -->
            <div class="space-y-6">
                <!-- 控制面板 -->
                <div class="bg-white rounded-lg shadow-md p-6 fade-in">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-sliders-h text-purple-500 mr-2"></i>
                        印章设置
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">印章位置</label>
                            <div class="grid grid-cols-3 gap-2">
                                <button class="position-btn py-2 px-4 border rounded-lg text-sm font-medium transition-colors" data-position="top-left">左上</button>
                                <button class="position-btn py-2 px-4 border rounded-lg text-sm font-medium transition-colors" data-position="top-center">中上</button>
                                <button class="position-btn py-2 px-4 border rounded-lg text-sm font-medium transition-colors" data-position="top-right">右上</button>
                                <button class="position-btn py-2 px-4 border rounded-lg text-sm font-medium transition-colors" data-position="center">居中</button>
                                <button class="position-btn py-2 px-4 border rounded-lg text-sm font-medium transition-colors" data-position="bottom-left">左下</button>
                                <button class="position-btn py-2 px-4 border rounded-lg text-sm font-medium transition-colors" data-position="bottom-center">中下</button>
                                <button class="position-btn py-2 px-4 border rounded-lg text-sm font-medium transition-colors" data-position="bottom-right">右下</button>
                            </div>
                        </div>
                        <div>
                            <label for="scaleRange" class="block text-sm font-medium text-gray-700 mb-2">印章大小</label>
                            <input type="range" id="scaleRange" min="10" max="200" value="50" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>小</span>
                                <span>中</span>
                                <span>大</span>
                            </div>
                        </div>
                        <div>
                            <label for="opacityRange" class="block text-sm font-medium text-gray-700 mb-2">透明度</label>
                            <input type="range" id="opacityRange" min="0" max="100" value="100" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>透明</span>
                                <span>半透明</span>
                                <span>不透明</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 操作按钮 -->
                <div class="bg-white rounded-lg shadow-md p-6 fade-in">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-play-circle text-blue-500 mr-2"></i>
                        执行操作
                    </h3>
                    <div class="space-y-3">
                        <button id="processBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                            <i class="fas fa-magic mr-2"></i>
                            生成盖章PDF
                        </button>
                        <button id="previewBtn" class="w-full bg-green-600 hover:bg-green-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                            <i class="fas fa-eye mr-2"></i>
                            预览效果
                        </button>
                        <button id="downloadBtn" class="w-full bg-purple-600 hover:bg-purple-700 text-white font-medium py-3 px-4 rounded-lg transition-colors disabled:bg-gray-400 disabled:cursor-not-allowed">
                            <i class="fas fa-download mr-2"></i>
                            下载结果
                        </button>
                    </div>
                </div>

                <!-- 状态显示 -->
                <div id="statusArea" class="bg-white rounded-lg shadow-md p-6 hidden fade-in">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">
                        <i class="fas fa-info-circle text-yellow-500 mr-2"></i>
                        处理状态
                    </h3>
                    <div id="statusMessage" class="text-sm text-gray-600"></div>
                    <div class="mt-4">
                        <div id="progressBar" class="w-full bg-gray-200 rounded-full h-2">
                            <div id="progressFill" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="space-y-6">
            <div class="container">
                <h2>HTML转Word工具</h2>
                <textarea id="htmlContent" placeholder="在此粘贴完整的HTML内容..."></textarea>
                <button onclick="exportToWord()">导出为Word文档</button>
            </div>
            <div class="container">
                <h1>CSV转Excel工具</h1>
                <div class="tips">
                    温馨提示：请将CSV内容粘贴到下方文本框，点击导出按钮即可下载Excel文件（自动处理中文编码问题）
                </div>
                <textarea id="csvInput" placeholder="请在此粘贴您的CSV内容..."></textarea>
                <button onclick="exportExcel()">导出Excel文件</button>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-white border-t mt-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-500 text-sm">© 2025 PDF盖章工具 - 基于JavaScript实现</p>
                <div class="flex space-x-4 mt-4 md:mt-0">
                    <span class="text-gray-400 text-sm">使用 jsPDF 和 pdf-lib 库</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- 模态框 -->
    <div id="previewModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-4xl w-full mx-4">
                    <div class="flex justify-between items-center p-6 border-b">
                        <h3 class="text-xl font-bold text-gray-800">盖章效果预览</h3>
                        <button id="closePreview" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <div id="previewContent" class="bg-gray-100 rounded-lg p-4 min-h-96 flex items-center justify-center">
                            <p class="text-gray-500">预览内容将在这里显示</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let pdfFile = null;
        let imageFile = null;
        let stampPosition = 'top-right';
        let stampScale = 50;
        let stampOpacity = 100;

        // DOM 元素获取
        const pdfDropZone = document.getElementById('pdfDropZone');
        const pdfInput = document.getElementById('pdfInput');
        const pdfPreview = document.getElementById('pdfPreview');
        const pdfFileName = document.getElementById('pdfFileName');
        
        const imageDropZone = document.getElementById('imageDropZone');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const stampPreview = document.getElementById('stampPreview');
        
        const positionBtns = document.querySelectorAll('.position-btn');
        const scaleRange = document.getElementById('scaleRange');
        const opacityRange = document.getElementById('opacityRange');
        
        const processBtn = document.getElementById('processBtn');
        const previewBtn = document.getElementById('previewBtn');
        const downloadBtn = document.getElementById('downloadBtn');
        
        const statusArea = document.getElementById('statusArea');
        const statusMessage = document.getElementById('statusMessage');
        const progressFill = document.getElementById('progressFill');
        
        const previewModal = document.getElementById('previewModal');
        const closePreview = document.getElementById('closePreview');
        const previewContent = document.getElementById('previewContent');

        // 初始化事件监听器
        function initEventListeners() {
            // PDF 文件处理
            pdfDropZone.addEventListener('click', () => pdfInput.click());
            pdfDropZone.addEventListener('dragover', handleDragOver);
            pdfDropZone.addEventListener('dragleave', handleDragLeave);
            pdfDropZone.addEventListener('drop', handlePdfDrop);
            pdfInput.addEventListener('change', handlePdfSelect);

            // 图片文件处理
            imageDropZone.addEventListener('click', () => imageInput.click());
            imageDropZone.addEventListener('dragover', handleDragOver);
            imageDropZone.addEventListener('dragleave', handleDragLeave);
            imageDropZone.addEventListener('drop', handleImageDrop);
            imageInput.addEventListener('change', handleImageSelect);

            // 位置按钮
            positionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    positionBtns.forEach(b => b.classList.remove('bg-blue-600', 'text-white'));
                    this.classList.add('bg-blue-600', 'text-white');
                    stampPosition = this.dataset.position;
                    updatePreview();
                });
            });

            // 缩放和透明度控制
            scaleRange.addEventListener('input', function() {
                stampScale = this.value;
                updatePreview();
            });

            opacityRange.addEventListener('input', function() {
                stampOpacity = this.value;
                updatePreview();
            });

            // 操作按钮
            processBtn.addEventListener('click', processPdf);
            previewBtn.addEventListener('click', showPreview);
            downloadBtn.addEventListener('click', downloadPdf);

            // 模态框控制
            closePreview.addEventListener('click', () => previewModal.classList.add('hidden'));

            // 设置按钮
            document.getElementById('settingsBtn').addEventListener('click', showSettings);
        }

        // 拖拽处理函数
        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
        }

        function handlePdfDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type === 'application/pdf') {
                pdfFile = files[0];
                showPdfPreview();
            } else {
                showStatus('请选择有效的PDF文件', 'error');
            }
        }

        function handlePdfSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                pdfFile = files[0];
                showPdfPreview();
            }
        }

        function handleImageDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                imageFile = files[0];
                showImagePreview();
            } else {
                showStatus('请选择有效的图片文件', 'error');
            }
        }

        function handleImageSelect(e) {
            const files = e.target.files;
            if (files.length > 0) {
                imageFile = files[0];
                showImagePreview();
            }
        }

        // 显示PDF预览
        function showPdfPreview() {
            pdfFileName.textContent = pdfFile.name;
            pdfPreview.classList.remove('hidden');
            updateButtonStates();
            showStatus('PDF文件已加载成功', 'success');
        }

        // 显示图片预览
        function showImagePreview() {
            const reader = new FileReader();
            reader.onload = function(e) {
                stampPreview.src = e.target.result;
                imagePreview.classList.remove('hidden');
                updateButtonStates();
                showStatus('印章图片已加载成功', 'success');
            }
            reader.readAsDataURL(imageFile);
        }

        // 更新按钮状态
        function updateButtonStates() {
            const hasFiles = pdfFile && imageFile;
            processBtn.disabled = !hasFiles;
            previewBtn.disabled = !hasFiles;
            downloadBtn.disabled = !hasFiles;
        }

        // 更新预览
        function updatePreview() {
            if (stampPreview.src && stampPreview.src !== '') {
                const scale = stampScale / 50;
                stampPreview.style.transform = `scale(${scale})`;
                stampPreview.style.opacity = stampOpacity / 100;
            }
        }

        // 显示状态信息
        function showStatus(message, type) {
            statusArea.classList.remove('hidden');
            statusMessage.textContent = message;
            
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            };
            
            progressFill.className = `h-2 rounded-full transition-all duration-300 ${colors[type] || colors.info}`;
            progressFill.style.width = '100%';
            
            setTimeout(() => {
                progressFill.style.width = '0%';
            }, 3000);
        }

        // 处理PDF添加印章
        async function processPdf() {
            if (!pdfFile || !imageFile) {
                showStatus('请先选择PDF文件和印章图片', 'error');
                return;
            }

            showStatus('正在处理PDF文档...', 'info');
            
            try {
                // 读取PDF文件
                const pdfData = await readFileAsArrayBuffer(pdfFile);
                const pdfDoc = await PDFLib.PDFDocument.load(pdfData);
                
                // 读取图片文件
                const imageData = await readFileAsArrayBuffer(imageFile);
                let image;
                if (imageFile.type === 'image/png') {
                    image = await pdfDoc.embedPng(imageData);
                } else {
                    image = await pdfDoc.embedJpg(imageData);
                }

                const pages = pdfDoc.getPages();
                const firstPage = pages[0];
                const { width, height } = firstPage.getSize();

                // 计算印章位置和大小
                const stampWidth = (width * stampScale) / 100;
                const stampHeight = (stampWidth * image.height) / image.width;

                let x, y;
                const margin = 20;

                switch (stampPosition) {
                    case 'top-left':
                        x = margin;
                        y = height - stampHeight - margin;
                        break;
                    case 'top-center':
                        x = (width - stampWidth) / 2;
                        y = height - stampHeight - margin;
                        break;
                    case 'top-right':
                        x = width - stampWidth - margin;
                        y = height - stampHeight - margin;
                        break;
                    case 'center':
                        x = (width - stampWidth) / 2;
                        y = (height - stampHeight) / 2;
                        break;
                    case 'bottom-left':
                        x = margin;
                        y = margin;
                        break;
                    case 'bottom-center':
                        x = (width - stampWidth) / 2;
                        y = margin;
                        break;
                    case 'bottom-right':
                        x = width - stampWidth - margin;
                        y = margin;
                        break;
                    default:
                        x = width - stampWidth - margin;
                        y = height - stampHeight - margin;
                }

                // 在所有页面添加印章
                pages.forEach(page => {
                    page.drawImage(image, {
                        x,
                        y,
                        width: stampWidth,
                        height: stampHeight,
                        opacity: stampOpacity / 100
                    });
                });

                // 保存处理后的PDF
                const modifiedPdfBytes = await pdfDoc.save();
                const blob = new Blob([modifiedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                
                // 存储结果供下载使用
                window.processedPdfUrl = url;
                
                showStatus('PDF处理完成！可以预览或下载结果', 'success');
                downloadBtn.classList.add('success-pulse');
                setTimeout(() => downloadBtn.classList.remove('success-pulse'), 1000);
                
            } catch (error) {
                console.error('处理PDF时出错:', error);
                showStatus('处理PDF时发生错误: ' + error.message, 'error');
            }
        }

        // 显示预览
        function showPreview() {
            if (!window.processedPdfUrl) {
                showStatus('请先处理PDF文档', 'warning');
                return;
            }

            previewContent.innerHTML = `
                <iframe src="${window.processedPdfUrl}" width="100%" height="500px" class="border rounded"></iframe>
                <div class="mt-4 text-center">
                    <p class="text-gray-600">预览模式 - 盖章效果显示</p>
                </div>
            `;
            previewModal.classList.remove('hidden');
        }

        // 下载PDF
        function downloadPdf() {
            if (!window.processedPdfUrl) {
                showStatus('请先处理PDF文档', 'warning');
                return;
            }

            const a = document.createElement('a');
            a.href = window.processedPdfUrl;
            a.download = `stamped_${pdfFile.name}`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            showStatus('PDF文件下载开始', 'success');
        }

        // 工具函数
        function readFileAsArrayBuffer(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsArrayBuffer(file);
            });
        }

        function showSettings() {
            showStatus('设置功能开发中...', 'info');
        }

        // 初始化默认位置按钮
        document.querySelector('.position-btn[data-position="top-right"]').classList.add('bg-blue-600', 'text-white');

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            showStatus('欢迎使用PDF盖章工具！请上传PDF文件和印章图片', 'info');
        });

        function exportToWord() {
            // 获取用户输入的HTML内容
            const content = document.getElementById('htmlContent').value;

            // 创建完整的HTML文档结构
            const fullHtml = `
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    ${extractHeadContent(content)}
</head>
${extractBodyContent(content)}
</html>`;

            // 处理UTF-8编码的BOM头
            const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);

            // 创建Blob对象
            const blob = new Blob([bom, fullHtml], {
                type: 'application/msword;charset=UTF-8'
            });

            // 创建下载链接
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `document-${new Date().getTime()}.doc`;

            // 触发下载
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // 提取<head>内容（如果有）
        function extractHeadContent(html) {
            const headMatch = html.match(/<head[^>]*>([\s\S]*?)<\/head>/i);
            return headMatch ? headMatch[1] : '';
        }

        // 提取<body>内容（如果没有则包含全部内容）
        function extractBodyContent(html) {
            const bodyMatch = html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);
            return bodyMatch ? `<body>${bodyMatch[1]}</body>` : `<body>${html}</body>`;
        }

        function exportExcel() {
            const csvContent = document.getElementById('csvInput').value.trim();

            if (!csvContent) {
                alert("请输入CSV内容");
                return;
            }

            // 添加UTF-8 BOM头解决中文乱码
            const bom = new Uint8Array([0xEF, 0xBB, 0xBF]);
            const blob = new Blob([bom, csvContent], {
                type: 'text/csv;charset=UTF-8'
            });

            // 创建下载链接
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `data_${new Date().toLocaleDateString()}.csv`;

            // 触发下载
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(link.href);
        }
    </script>
</body>
</html>
